---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: yes
---


## Loading and preprocessing the data

### Load the data

Data loaded into **activity** tibble using **tidyverse::read_csv()** 

```{r load, echo=TRUE, message=FALSE}
library(tidyverse)
activity <- read_csv("activity.zip")
```

## What is mean total number of steps taken per day?

### Histogram of total number of steps taken per day

```{r stepshist, echo=TRUE}
activity %>% drop_na(steps) %>%
      group_by(date) %>% 
      summarise(daily_steps = sum(steps, na.rm = T)) %>% 
      ggplot(aes(x = daily_steps)) +
      geom_histogram(binwidth = 2000,
                     fill = "steelblue",
                     colour = "white") +
      labs(title = "Daily steps histogram",
           x = "Daily steps",
           y = "") +
      theme_minimal()
```

### Mean and median of total number of steps taken per day

```{r stepsmed, echo=TRUE}
daily_steps <- activity %>% drop_na(steps) %>%
      group_by(date) %>% 
      summarise(steps = sum(steps, na.rm = T))
options(scipen = 999999)
daily_steps_mean <- mean(daily_steps$steps)
daily_steps_median <- median(daily_steps$steps)
```

The mean of total number of steps taken per day is **`r round(daily_steps_mean, 2)`** and the median is **`r round(daily_steps_median, 2)`**.

## What is the average daily activity pattern?

### Time series plot of average steps across intervals

```{r dailypattern, echo=TRUE}
activity %>% drop_na(steps) %>%
      group_by(interval) %>%
      summarise(interval_mean_steps = mean(steps, na.rm = T)) %>% 
      ggplot(aes(x = interval, y = interval_mean_steps)) +
      geom_line(colour = "steelblue") +
      scale_x_continuous(breaks = seq(0, 2300, by = 200)) +
      labs(title = "Average steps for each interval",
           x = "Interval",
           y = "Average steps") +
      theme_minimal()
```

### Interval with highest average number of steps

```{r maxavgsteps, echo=TRUE}
interval_max_steps <- activity %>% drop_na(steps) %>%
      group_by(interval) %>%
      summarise(interval_mean_steps = mean(steps, na.rm = T)) %>% 
      filter(interval_mean_steps == max(interval_mean_steps))
```

5-minute interval that, on average across all the days in the dataset, contains the maximum number of steps is number **`r interval_max_steps$interval`**.

## Imputing missing values

### Total number of missing values in dataset

```{r totalNA, echo=TRUE}
activity_NA <- activity %>% 
      summarise(total_missing = sum(is.na(steps)))
```

Total number of missig values in dataset is **`r activity_NA$total_missing`**.

### New dataset withou missing values

Missing values for a specific interval were filled using the average number of steps for that interval computed on the same interval for days with valid data.

```{r fillNA, echo=TRUE}
# dataset with average numerber of steps for each interval
interval_steps <- activity %>% drop_na(steps) %>%
      group_by(interval) %>%
      summarise(interval_mean_steps = mean(steps, na.rm = T))
# dataset with missing values filled by interval averages
activity_nomissing <- activity %>%
      left_join(interval_steps, by = "interval") %>% 
      mutate(steps = ifelse(is.na(steps), interval_mean_steps, steps))
```

### Histogram of total number of steps taken per day for data without missing values

```{r stepshistnomiss, echo=TRUE}
activity_nomissing %>% group_by(date) %>% 
      summarise(daily_steps = sum(steps, na.rm = T)) %>% 
      ggplot(aes(x = daily_steps)) +
      geom_histogram(binwidth = 2000,
                     fill = "steelblue",
                     colour = "white") +
      labs(title = "Daily steps histogram without NAs",
           x = "Daily steps",
           y = "") +
      theme_minimal()
```

### Mean and median of total number of steps taken per day for data without missing values

```{r stepsmednomiss, echo=TRUE}
daily_steps_nomissing <- activity_nomissing %>% group_by(date) %>% 
      summarise(steps = sum(steps, na.rm = T))
daily_steps_mean_nomissing <- mean(daily_steps_nomissing$steps)
daily_steps_median_nomissing <- median(daily_steps_nomissing$steps)
```

The mean of total number of steps taken per day is **`r round(daily_steps_mean_nomissing, 2)`** and the median is **`r round(daily_steps_median_nomissing, 2)`**.  
The mean computed on dataset without missing values doesn't differ from the mean computed on data with missing values. This is a consequence of my imputation method.  
Median of daily steps distribution without missing values differs slightly from the one computed on data with missing values.  
Mean and median are the same because, imputing missing values with interval averages, I've introduced several days with total number of steps equal to the mean and so the distribution is equally splitted by its mean value.  
Imputing missing value with interval averages, we observe a daily steps distribution with a peak in histogram's bin containing daily steps average value.

## Are there differences in activity patterns between weekdays and weekends?

### Day type variable

```{r daytype, echo=TRUE}
activity_nomissing <- activity_nomissing %>% 
      mutate(day = weekdays(date),
             day_type = factor(ifelse(day %in% c("sabato", "domenica"), "weekend", "weekday"))) # italian locale

```

### Panel plot of weekdays vs weekends

```{r weekdaypattern, echo=TRUE}
activity_nomissing %>% group_by(interval, day_type) %>%
      summarise(interval_mean_steps = mean(steps, na.rm = T)) %>% 
      ggplot(aes(x = interval, y = interval_mean_steps)) +
      geom_line(colour = "coral", size = 1) +
      scale_x_continuous(breaks = seq(0, 2300, by = 200)) +
      geom_vline(xintercept = 500) +
      geom_vline(xintercept = 800) +
      geom_vline(xintercept = 2000) +
      geom_vline(xintercept = 2200) +
      annotate("rect", xmin = 0, xmax = 500, ymin = 0, ymax = 235, alpha = 0.2, fill = "black") +
      annotate("rect", xmin = 500, xmax = 800, ymin = 0, ymax = 235, alpha = 0.2, fill = "steelblue") +
      annotate("rect", xmin = 800, xmax = 2000, ymin = 0, ymax = 235, alpha = 0.2, fill = "yellow") +
      annotate("rect", xmin = 2000, xmax = 2200, ymin = 0, ymax = 235, alpha = 0.2, fill = "steelblue") +
      annotate("rect", xmin = 2200, xmax = 2350, ymin = 0, ymax = 235, alpha = 0.2, fill = "black") +
      annotate("text", x = 500, y = 235, hjust = -0.25, size = 3.5, label = "5:00") +
      annotate("text", x = 800, y = 235, hjust = -0.25, size = 3.5, label = "8:00") +
      annotate("text", x = 2000, y = 235, hjust = -0.25, size = 3.5, label = "20:00") +
      annotate("text", x = 2200, y = 235, hjust = -0.25, size = 3.5, label = "22:00") +
      labs(title = "Average steps for each interval: weekdays vs weekend",
           x = "Interval",
           y = "Average steps") +
      theme_minimal() +
      facet_grid(rows = vars(day_type), switch = "y")
```

Panel plot highlights some differences in daily patterns. During weekday we observe more steps in the early morning (form 5:00 to 8:00) while in the weekends we see more steps in the evening (from 20.00 to 22:00).
